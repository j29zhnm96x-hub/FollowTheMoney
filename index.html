<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FollowTheMoney</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,viewport-fit=cover,user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="FollowTheMoney">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" sizes="180x180" href="img/favicon.png?v=2">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" sizes="180x180" href="img/favicon.png?v=2">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div id="app" class="app">
    <section id="screen-home" class="screen active" aria-label="Home">
      <header class="top-bar">
        <button id="btnHistory" class="pill accent" aria-label="History">History</button>
        <h1 class="logo">FollowTheMoney</h1>
        <button id="btnSettings" class="pill accent" aria-label="Settings">
          <svg class="icon-gear" viewBox="0 0 24 24" role="img" aria-hidden="true" focusable="false">
            <path fill="#fff" d="M19.14 12.94c.04-.3.06-.61.06-.94s-.02-.64-.07-.94l2.03-1.58a.5.5 0 0 0 .12-.63l-1.92-3.32a.5.5 0 0 0-.6-.22l-2.39.96a7.08 7.08 0 0 0-1.63-.94l-.36-2.54A.5.5 0 0 0 14.98 2h-3.96a.5.5 0 0 0-.5.42l-.36 2.54c-.59.24-1.13.55-1.63.94l-2.39-.96a.5.5 0 0 0-.6.22L3.62 8.48a.5.5 0 0 0 .12.63l2.03 1.58c-.05.3-.07.62-.07.94s.02.64.07.94L3.74 13.15a.5.5 0 0 0-.12.63l1.92 3.32c.13.23.4.32.63.22l2.39-.96c.5.4 1.04.71 1.63.94l.36 2.54c.04.25.25.42.5.42h3.96c.25 0 .46-.17.5-.42l.36-2.54c.59-.24 1.13-.55 1.63-.94l2.39.96c.23.1.5.01.63-.22l1.92-3.32a.5.5 0 0 0-.12-.63l-2.03-1.58zM12 15.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7z" />
          </svg>
        </button>
      </header>
      <main class="center-stack">
        <div class="balance-label">Balance <span id="seasonBadge" class="badge" hidden>Off-season</span></div>
        <div id="balance" class="balance" aria-label="Balance">0.00 €</div>
        <div id="dashboardGrid" class="dashboard-grid" hidden>
          <div class="dashboard-card" data-period="day">
            <div class="card-label">Daily</div>
            <div id="dailyAllowance" class="card-allowance">0.00 €</div>
            <div id="dailySpent" class="card-spent">0.00 €</div>
          </div>
          <div class="dashboard-card" data-period="week">
            <div class="card-label">Weekly</div>
            <div id="weeklyAllowance" class="card-allowance">0.00 €</div>
            <div id="weeklySpent" class="card-spent">0.00 €</div>
          </div>
          <div class="dashboard-card" data-period="month">
            <div class="card-label">Monthly</div>
            <div id="monthlyAllowance" class="card-allowance">0.00 €</div>
            <div id="monthlySpent" class="card-spent">0.00 €</div>
          </div>
        </div>
        <div id="recentList" class="recent-list" aria-label="Recent transactions"></div>
      </main>
      <div class="float-buttons" id="floatButtons">
        <button id="btnAddIncome" class="circle income" aria-label="Add income"></button>
        <button id="btnAddExpense" class="circle expense" aria-label="Add expense"></button>
      </div>
    </section>
    <section id="screen-history" class="screen" aria-label="History" hidden>
      <header class="top-bar">
        <button id="btnHome" class="pill accent" aria-label="Home">Home</button>
        <h1 class="logo">History</h1>
        <div class="pill ghost hidden-placeholder">•</div>
      </header>
      <div class="type-filter-card">
        <div id="historyTypeFilters" class="type-filters" role="group" aria-label="Type filters">
          <button class="type-pill" data-type="income">Income</button>
          <button class="type-pill" data-type="all">All</button>
          <button class="type-pill" data-type="expense">Expense</button>
        </div>
      </div>
      <div id="historyGroupSummary" class="group-summary" hidden></div>
      <div id="historyFilter" class="history-filter" hidden></div>
      <div class="chip-row" id="categoryChipRow" aria-label="Categories"></div>
      <div class="chip-row" id="nameChipRow" aria-label="Names"></div>
      <main class="history-list" id="historyList" aria-live="polite"></main>
    </section>
    <section id="screen-summary" class="screen" aria-label="Group summary" hidden>
      <header class="top-bar">
        <button id="btnSummaryBack" class="pill accent" aria-label="Back to history">Back</button>
        <h1 class="logo">Summary</h1>
        <div class="pill ghost hidden-placeholder">•</div>
      </header>
      <div class="summary-shell">
        <article class="summary-card" aria-live="polite">
          <p id="summaryLabel" class="summary-label">All entries</p>
          <div class="summary-total">
            <div>
              <span>Total balance</span>
              <strong id="summaryNet">0.00 €</strong>
            </div>
            <div>
              <span>Entries</span>
              <strong id="summaryCount">0</strong>
            </div>
          </div>
          <div class="summary-metrics">
            <div class="metric">
              <span>Average amount</span>
              <strong id="summaryAverage">0.00 €</strong>
            </div>
          </div>
          <p id="summaryFilters" class="summary-filters">No filters applied</p>
        </article>
        <section class="summary-list" aria-label="Preview transactions">
          <h2>Preview</h2>
          <p class="summary-hint">Swipe left on an entry to toggle whether it counts toward the average.</p>
          <div id="summaryList" class="summary-list-items"></div>
        </section>
      </div>
    </section>
    <section id="screen-graph" class="screen" aria-label="Insights" hidden>
      <header class="graph-top-bar" role="banner">
        <h1 class="graph-title" aria-label="Insights">Insights</h1>
        <div class="graph-toolbar">
          <button id="btnGraphTimeline" class="graph-icon-btn" type="button" aria-pressed="false" aria-label="Toggle timeline view">
            <svg viewBox="0 0 24 24" role="presentation" aria-hidden="true">
              <rect x="4" y="11" width="3" height="7" rx="1" />
              <rect x="9" y="8" width="3" height="10" rx="1" />
              <rect x="14" y="5" width="3" height="13" rx="1" />
              <rect x="19" y="3" width="3" height="15" rx="1" />
            </svg>
          </button>
          <div id="graphTypeFilters" class="graph-type-filters" role="group" aria-label="Graph Type">
            <button class="graph-type-pill" data-graph-type="income">Income</button>
            <button class="graph-type-pill" data-graph-type="expense">Expense</button>
          </div>
          <div class="graph-range-control">
            <button id="graphRangeBtn" class="graph-range-btn" type="button" aria-haspopup="true" aria-expanded="false">Time range: All time</button>
            <div id="graphRangeMenu" class="graph-range-menu" hidden role="menu">
              <div class="graph-range-list">
                <button type="button" data-range="this_week">This week</button>
                <button type="button" data-range="last_week">Last week</button>
                <button type="button" data-range="this_month">This month</button>
                <button type="button" data-range="last_month">Last month</button>
                <button type="button" id="graphRangeClear" class="graph-range-clear">All time</button>
              </div>
              <div class="graph-range-custom">
                <div class="range-row">
                  <label for="graphRangeStart">Start</label>
                  <input id="graphRangeStart" type="date" />
                </div>
                <div class="range-row">
                  <label for="graphRangeEnd">End</label>
                  <input id="graphRangeEnd" type="date" />
                </div>
                <button id="graphRangeApply" type="button" class="graph-range-apply">Apply custom</button>
              </div>
            </div>
          </div>
        </div>
        <div class="graph-view-toggle" role="radiogroup" aria-label="Group by">
          <label>
            <input type="radio" name="graphGroup" value="category" checked>
            <span>Categories</span>
          </label>
          <label>
            <input type="radio" name="graphGroup" value="name">
            <span>Names</span>
          </label>
        </div>
      </header>
      <div class="graph-board">
        <div class="graph-main" id="graphMain">
          <div class="graph-breakdown-card">
            <div class="graph-breakdown-header">
              <h2>Breakdown</h2>
              <span class="timeline-scroll-indicators legend-scroll-indicators" aria-hidden="true" id="graphLegendScrollIndicators">
                <span class="timeline-scroll-arrow up" id="graphLegendScrollArrowUp"></span>
                <span class="timeline-scroll-arrow down" id="graphLegendScrollArrowDown"></span>
              </span>
            </div>
            <div class="graph-legend" id="graphLegend" aria-live="polite"></div>
          </div>
          <div class="graph-chart-card">
            <div class="graph-canvas-shell">
              <div class="graph-total-overlay">
                <p class="total-label">Total</p>
                <p id="graphTotalValue" class="total-amount">0.00 €</p>
                <p id="graphTotalScope" class="total-scope">Income · by categories</p>
              </div>
              <div class="graph-canvas-wrap">
                <canvas id="graphCanvas" width="340" height="340" aria-label="Distribution chart"></canvas>
                <div id="graphEmpty" class="graph-empty" hidden>No data to visualize yet.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="graph-timeline" id="graphTimeline" hidden>
          <div class="graph-timeline-card">
            <header class="timeline-header">
              <div>
                <h2>Timeline</h2>
                <p class="timeline-subtitle">Income vs Expense over time</p>
              </div>
              <div style="display:flex;flex-direction:column;align-items:flex-end;gap:.5rem;">
                <button id="btnTimelineCursorToggle" class="timeline-cursor-toggle" type="button" aria-pressed="false">Inspect</button>
                <div class="timeline-legend">
                  <span><span class="dot income"></span> Income</span>
                  <span><span class="dot expense"></span> Expense</span>
                </div>
              </div>
            </header>
            <div class="timeline-canvas-wrap" id="timelineCanvasWrap">
              <canvas id="timelineCanvas" width="720" height="360" aria-label="Timeline chart"></canvas>
              <div id="timelineEmpty" class="timeline-empty" hidden>Need at least two days of data to draw trends.</div>
              <div id="timelineCursor" class="timeline-cursor" hidden aria-hidden="true"></div>
              <div id="timelineCursorPopup" class="timeline-popup" hidden aria-live="polite">
                <p id="timelinePopupDate" class="timeline-popup-date">
                  <span id="timelinePopupDateText"></span>
                  <span class="timeline-scroll-indicators">
                    <span class="timeline-scroll-arrow up" id="timelineScrollArrowUp"></span>
                    <span class="timeline-scroll-arrow down" id="timelineScrollArrowDown"></span>
                  </span>
                </p>
                <ul id="timelinePopupList" class="timeline-popup-list"></ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <div id="settingsModal" class="modal" hidden>
      <div class="modal-overlay" data-dismiss></div>
      <div class="modal-panel" role="dialog" aria-modal="true" aria-label="Settings">
        <div class="settings-header">
          <div class="settings-title" aria-label="Settings">
            <span class="settings-gear" aria-hidden="true">⚙</span>
            <h2>Settings</h2>
          </div>
          <label class="toggle-row switch inline-switch">
            <input type="checkbox" id="themeToggle">
            <span class="switch-ui" aria-hidden="true"><span class="switch-thumb"></span></span>
            <span class="theme-label">Light</span>
          </label>
        </div>
        <div class="settings-body">
          <div class="settings-help-btn-row" style="margin-bottom:.6rem;">
            <button id="btnHelpManual" class="btn ghost">Help & Support</button>
            <div class="app-version" aria-hidden="true">v0.9.6.1</div>
          </div>
          <div class="settings-grid">
            <section class="settings-card" aria-labelledby="generalHeading">
              <div>
                <h3 id="generalHeading">General</h3>
                <p class="card-subtitle">Choose how dates appear and how you add entries.</p>
              </div>
              <div class="setting-row">
                <label for="dateFormat" class="small-label">Date format</label>
                <select id="dateFormat" class="text-input select-input">
                  <option value="dmy">Day / Month / Year</option>
                  <option value="mdy">Month / Day / Year</option>
                  <option value="ymd">Year / Month / Day</option>
                </select>
                <div class="preview small">Applies to recent cards and history.</div>
              </div>
              <div class="setting-row">
                <label for="currencySymbol" class="small-label">Currency symbol</label>
                <input id="currencySymbol" type="text" class="text-input" maxlength="3" placeholder="€" />
                <div class="preview small">Shown after every amount (e.g. €, $, Kč).</div>
              </div>
              <div class="setting-row">
                <label class="small-label" for="singleButtonModeToggle">Home input buttons</label>
                <label class="toggle-row switch">
                  <input type="checkbox" id="singleButtonModeToggle">
                  <span class="switch-ui" aria-hidden="true"><span class="switch-thumb"></span></span>
                  <span>Single button mode</span>
                </label>
                <div class="preview small">Tap for expense, press &amp; hold 1s for income.</div>
              </div>
            </section>
            <section class="settings-card" aria-labelledby="seasonHeading">
              <div>
                <h3 id="seasonHeading">Seasonal Budget</h3>
                <p class="card-subtitle">Enable seasonal mode or use simple budget tracking.</p>
              </div>
              <label class="toggle-row switch">
                <input type="checkbox" id="seasonalModeToggle">
                <span class="switch-ui" aria-hidden="true"><span class="switch-thumb"></span></span>
                <span>Seasonal Budget Mode</span>
              </label>
              <div class="preview small">When off, dashboard shows Today/This Week/This Month income & expenses.</div>
              <div id="seasonalSettings" class="seasonal-settings">
                <div class="setting-row">
                  <label for="seasonStart" class="small-label">Start of working season</label>
                  <input id="seasonStart" type="date" class="text-input date-compact" />
                </div>
                <div class="setting-row">
                  <label for="seasonEnd" class="small-label">End of working season</label>
                  <input id="seasonEnd" type="date" class="text-input date-compact" />
                </div>
                <button id="saveSeason" class="btn accent" disabled>Save Season Dates</button>
                <div class="setting-row">
                  <div id="seasonInfo" class="preview small"></div>
                  <div id="allowanceInfo" class="preview small"></div>
                </div>
              </div>
            </section>
            <section class="settings-card" aria-labelledby="privacyHeading">
              <div>
                <h3 id="privacyHeading">History lock</h3>
                <p class="card-subtitle">Prevent accidental swipes from deleting entries.</p>
              </div>
              <label class="toggle-row switch">
                <input type="checkbox" id="historyLockToggle">
                <span class="switch-ui" aria-hidden="true"><span class="switch-thumb"></span></span>
                <span>Lock swipe-to-delete</span>
              </label>
              <div class="preview small">You can still edit entries using the pencil icon.</div>
            </section>
            <section class="settings-card" aria-labelledby="dataHeading">
              <div>
                <h3 id="dataHeading">Data export & import</h3>
                <p class="card-subtitle">Back up everything and move between devices.</p>
              </div>
              <div class="setting-row">
                <button id="btnExportShare" class="btn accent full">Share backup</button>
                <div class="preview small">Uses the OS share sheet when available.</div>
              </div>
              <!-- Email backup option removed -->
              <div class="setting-row">
                <button id="btnImportData" class="btn ghost full">Import backup</button>
                <div class="preview small">Select a saved .json backup file to restore.</div>
                <input id="importFile" type="file" accept="application/json" hidden />
              </div>
            </section>
            <section class="settings-card" aria-labelledby="advancedHeading">
              <div>
                <h3 id="advancedHeading">Advanced</h3>
                <p class="card-subtitle">Reset the app if you need a clean slate.</p>
              </div>
              <div class="advanced-group">
                <button id="btnClearAll" class="btn danger">Clear All Data</button>
                <div class="preview small">Clears all transactions and resets settings. A confirmation will appear when you press the button.</div>
              </div>
            </section>
          </div>
          <div class="settings-actions">
            <button class="btn ghost full" data-dismiss>Close</button>
          </div>
        </div>
      </div>
    </div>
    <div id="helpModal" class="modal" hidden>
      <div class="modal-overlay" data-dismiss></div>
      <div class="modal-panel help-panel" role="dialog" aria-modal="true" aria-label="Help and Manual">
        <div class="settings-header">
          <div class="settings-title">
            <span class="settings-gear" aria-hidden="true">❓</span>
            <h2>User Manual</h2>
          </div>
          <button class="btn ghost" data-dismiss aria-label="Close help">Close</button>
        </div>
        <div class="help-content" aria-live="polite">
          <section>
            <h3>Welcome to FollowTheMoney</h3>
            <p>FollowTheMoney is a privacy-first money tracking app designed for simplicity and clarity. Track income and expenses, explore visual insights, and choose between Budget Mode for daily tracking or Seasonal Budget Mode for off-season planning. All your data stays on your device—no cloud, no tracking.</p>
          </section>

          <section>
            <h3>Quick Start</h3>
            <ol>
              <li>Tap the <strong>green circle</strong> (Income) or <strong>red circle</strong> (Expense) on the Home screen.</li>
              <li>Prefer a single control? Enable <em>Single button mode</em> in Settings → General. Tap once for an expense, or press &amp; hold for ~1 second—the button will fade from red to green as confirmation—then release to add income.</li>
              <li>Enter the amount using the numeric keypad (stored as cents with two decimals).</li>
              <li>Choose or type a <strong>Category</strong> (required) and <strong>Name</strong> (optional but recommended).</li>
              <li>Optionally tap "Add note" to include additional context.</li>
              <li>Tap <strong>Add</strong> to save the transaction.</li>
            </ol>
          </section>

          <section>
            <h3>Home Screen</h3>
            <p><strong>Balance:</strong> Shows your current total (income minus expenses).</p>
            <p><strong>Badge:</strong> Displays "Budget mode" by default, or "Off-season"/"Season active" when Seasonal Budget Mode is enabled.</p>
            <p><strong>Input Buttons:</strong> The default layout shows two circles (green for income, red for expense). If you enable Single button mode, only the red button remains—tap for expense, or press and hold until it morphs to green to submit an income entry.</p>
            <p><strong>Dashboard Cards:</strong></p>
            <ul>
              <li><strong>Budget Mode (default):</strong> Cards show <em>Today</em>, <em>This Week</em>, and <em>This Month</em> with income (green) and expenses (red) totals.</li>
              <li><strong>Seasonal Budget Mode:</strong> Cards display <em>Daily</em>, <em>Weekly</em>, and <em>Monthly</em> allowances with actual spending during off-season periods.</li>
            </ul>
            <p><strong>Recent Transactions:</strong> Quick view of your latest entries. Tap any item to edit.</p>
          </section>

          <section>
            <h3>History Screen</h3>
            <p><strong>Type Filters:</strong> Use the <em>Income</em>, <em>All</em>, or <em>Expense</em> pills at the top to filter transactions by type.</p>
            <p><strong>Category & Name Chips:</strong> Filter by category or name by tapping the chips below the type filters. Tap "All categories" or "All names" to clear the filter.</p>
            <p><strong>Group Summary:</strong> A blue summary card shows totals and entry count for your current filter selection. <em>Long-press</em> to open detailed breakdown.</p>
            <p><strong>Editing Transactions:</strong></p>
            <ul>
              <li>Tap the <strong>pencil icon</strong> on any transaction to edit.</li>
              <li><strong>Swipe left or right</strong> to delete (disabled when History Lock is on in Settings).</li>
              <li>When editing, you can modify amount, category, name, note, date/time, and set recurring frequency.</li>
            </ul>
            <p><strong>Recurring Transactions:</strong> When editing a transaction, enable "Repeat this transaction" and choose Weekly, Monthly, or Yearly frequency.</p>
          </section>

          <section>
            <h3>Insights Screen</h3>
            <p><strong>Best viewed in landscape mode.</strong> The Insights screen visualizes your financial data with interactive charts.</p>
            
            <h4>Classic View (Donut Chart)</h4>
            <ul>
              <li><strong>Breakdown Card (left):</strong> Lists categories or names with percentages and amounts. Excluded items are shown at the bottom of the list for clarity.</li>
              <li><strong>Donut Chart (right):</strong> Visual pie chart showing proportions of each category/name. Click a legend row to briefly highlight the corresponding slice in the donut.</li>
              <li><strong>Center Overlay:</strong> Shows total amount and current scope (e.g., "Expense · by categories").</li>
              <li><strong>Controls:</strong> Toggle between Income/Expense and group by Categories or Names. Use the <strong>Time Range</strong> control to restrict the visualization to common presets (This week, Last week, This month, Last month) or a <em>Custom</em> date range — the donut and breakdown will update to reflect the selected period.</li>
              <li><strong>Press &amp; hold exclusions:</strong> Press and hold a breakdown card for ~3 seconds to open a popup that can exclude that category/name from the donut. Excluded cards gain a red outline and an "Excluded" tag — they are moved to the bottom of the breakdown list to keep the focus on active items. Long-press an excluded card to include it again.</li>
            </ul>

            <h4>Timeline View</h4>
            <p>Tap the <strong>bar chart icon</strong> at the top to switch to Timeline mode.</p>
            <ul>
              <li><strong>Line Graph:</strong> Shows income (green) and expense (red) trends over time.</li>
              <li><strong>Inspect Mode:</strong> Tap the "Inspect" button to enable interactive cursor.</li>
              <li><strong>Draggable Cursor:</strong> Drag the vertical line across the timeline to view transactions for specific days.</li>
              <li><strong>Popup Details:</strong> Shows date and transaction list. <em>Scroll indicators</em> (arrows) appear when there are more than 2 transactions:
                <ul>
                  <li><strong>Down arrow (▼):</strong> More content below</li>
                  <li><strong>Up arrow (▲):</strong> More content above</li>
                  <li>Both arrows visible when in the middle of the list</li>
                </ul>
              </li>
              <li>Scroll inside the popup to view all transactions for that day.</li>
            </ul>
          </section>

          <section>
            <h3>Settings</h3>
            
            <h4>General</h4>
            <ul>
              <li><strong>Theme Toggle:</strong> Switch between Light and Dark themes (top-right).</li>
              <li><strong>Date Format:</strong> Choose Day/Month/Year, Month/Day/Year, or Year/Month/Day.</li>
              <li><strong>Currency Symbol:</strong> Customize the symbol displayed after amounts (€, $, etc.).</li>
              <li><strong>Home Input Buttons:</strong> Swap between two-circle layout (default) and Single button mode (tap for expense, hold for 1s to add income).</li>
            </ul>

            <h4>Seasonal Budget</h4>
            <ul>
              <li><strong>Toggle Switch:</strong> Turn Seasonal Budget Mode on or off.
                <ul>
                  <li><strong>Off (default):</strong> Dashboard shows Today/This Week/This Month totals.</li>
                  <li><strong>On:</strong> Dashboard shows Daily/Weekly/Monthly allowances during off-season.</li>
                </ul>
              </li>
              <li><strong>Season Dates:</strong> When enabled, set working season start/end dates to calculate off-season allowances.</li>
            </ul>

            <h4>History Lock</h4>
            <p>Enable to prevent accidental swipe-to-delete in History. You can still edit transactions using the pencil icon.</p>

            <h4>Data Export & Import</h4>
            <ul>
              <li><strong>Share backup:</strong> Creates a JSON file you can share via your device's share sheet.</li>
              <!-- Email backup help entry removed -->
              <li><strong>Import backup:</strong> Restore data from a JSON backup file. <em>Warning:</em> This replaces all current data—export first!</li>
              <li>Automatic local backups are saved in browser storage as a safety net.</li>
            </ul>

            <h4>Advanced</h4>
            <p><strong>Clear All Data:</strong> Deletes all transactions and resets settings. A confirmation dialog will appear before deletion.</p>
          </section>

          <section>
            <h3>Adding & Editing Transactions</h3>
            <p><strong>When creating:</strong></p>
            <ul>
              <li><strong>Amount:</strong> Use the numeric keypad (stored internally as cents).</li>
              <li><strong>Category:</strong> Required field. Used for grouping in Insights and filtering in History.</li>
              <li><strong>Name:</strong> Optional. Becomes required once you enter a category. Helps identify specific sources or payees.</li>
              <li><strong>Note:</strong> Optional. Tap "Add note" to include free-text details.</li>
            </ul>
            
            <p><strong>When editing:</strong></p>
            <ul>
              <li>All above fields plus:</li>
              <li><strong>Date/Time:</strong> Adjust to backdate entries.</li>
              <li><strong>Recurring:</strong> Enable "Repeat this transaction" and select frequency (Weekly/Monthly/Yearly).</li>
            </ul>
          </section>

          <section>
            <h3>Tips & Best Practices</h3>
            <ul>
              <li><strong>Use consistent categories:</strong> Autocomplete suggestions help you reuse existing categories and names.</li>
              <li><strong>Add names for clarity:</strong> While optional, names make it easier to identify transactions later.</li>
              <li><strong>Long-press for details:</strong> In History, long-press the group summary card to see detailed breakdowns.</li>
              <li><strong>Long-press to delete chips:</strong> Remove unwanted categories or names from suggestions by long-pressing chips.</li>
              <li><strong>Export regularly:</strong> Back up your data periodically via Settings → Share backup.</li>
              <li><strong>Use Budget Mode for simplicity:</strong> If you don't need seasonal tracking, keep Seasonal Budget Mode off for straightforward daily/weekly/monthly summaries.</li>
            </ul>
          </section>

          <section>
            <h3>Troubleshooting</h3>
            <dl>
              <dt>Q: The donut chart says "No data to visualize yet" but I have transactions.</dt>
              <dd>A: Ensure you've selected the correct type (Income or Expense). The app auto-switches if the opposite side has data, but zero-value transactions won't render.</dd>
              
              <dt>Q: Dashboard cards aren't updating after toggling Seasonal Budget Mode.</dt>
              <dd>A: Close and reopen Settings, or navigate to another screen and back. The cards should refresh automatically.</dd>
              
              <dt>Q: I can't delete transactions in History.</dt>
              <dd>A: Check if History Lock is enabled in Settings. Disable it to allow swipe-to-delete.</dd>
              
              <dt>Q: Recurring transactions aren't being created automatically.</dt>
              <dd>A: Recurring frequency is stored with the transaction for reference but doesn't trigger automatic creation yet. This feature is planned for future updates.</dd>
              
              <dt>Q: Timeline graph arrows aren't showing.</dt>
              <dd>A: Arrows only appear when there are more than 2 transactions for the selected day. Enable "Inspect" mode and drag to a busy day.</dd>
              
              <dt>Q: Where is my data stored?</dt>
              <dd>A: All data is stored locally in your browser's IndexedDB and localStorage. Nothing is sent to external servers.</dd>
              
              <dt>Q: I imported a backup but don't see my data.</dt>
              <dd>A: Reload the app after importing. Ensure the JSON file is a valid backup created by this app's export feature.</dd>
            </dl>
          </section>

          <section>
            <h3>Privacy & Security</h3>
            <ul>
              <li><strong>No cloud sync:</strong> Your data never leaves your device.</li>
              <li><strong>No tracking:</strong> The app doesn't collect analytics or usage data.</li>
              <li><strong>Local storage only:</strong> Uses browser IndexedDB and localStorage.</li>
              <li><strong>Export control:</strong> You control all backups—share them only with trusted parties.</li>
              <li><strong>PWA support:</strong> Install as a Progressive Web App for offline access and a native-like experience.</li>
            </ul>
          </section>

          <section>
            <h3>Keyboard Shortcuts & Accessibility</h3>
            <ul>
              <li>Press <strong>Tab</strong> to navigate between buttons and inputs.</li>
              <li>Press <strong>Escape</strong> to close modals and sheets.</li>
              <li>Large touch targets for mobile-friendly interaction.</li>
              <li>High-contrast Light theme available for improved visibility.</li>
              <li>Aria-live regions announce changes in History and Insights.</li>
            </ul>
          </section>

          <section>
            <h3>Technical Details</h3>
            <ul>
              <li><strong>Data structure:</strong> Transactions stored as { id, amountCents, createdAt, name, category, note, recurringFrequency }.</li>
              <li><strong>Color system:</strong> Chart colors derived deterministically from category/name labels using a hash-based palette.</li>
              <li><strong>Service Worker:</strong> Caches app shell for offline use. Updates trigger automatic reload when available.</li>
              <li><strong>No dependencies:</strong> Built with vanilla JavaScript—no external frameworks.</li>
            </ul>
          </section>

          <section>
            <h3>Contact & Support</h3>
            <p>Need help? Have a question? Have a suggestion? Found a bug?</p>
            <p>Please email to: <a href="mailto:followthemoneyapp@proton.me">followthemoneyapp@proton.me</a></p>
          </section>
        </div>
      </div>
    </div>
    <div id="sheet" class="sheet" hidden>
      <div class="sheet-overlay" data-dismiss></div>
      <div class="sheet-panel" aria-label="Amount entry" role="dialog">
        <div class="sheet-grabber"></div>
        <div id="sheetAmount" class="amount-display">0.00 €</div>
        <div id="sheetTypeLabel" class="sheet-type-label" aria-hidden="true"></div>
        <input id="rawDigits" type="tel" inputmode="numeric" class="hidden-input" />
        <div id="categoryContainer" class="category-container" hidden>
          <label for="categoryInput" class="small-label">Category</label>
          <input id="categoryInput" type="text" class="text-input" list="categoryList" placeholder="Select or type category" autocomplete="off" />
          <datalist id="categoryList"></datalist>
          <div id="categorySuggestions" class="suggestion-row" hidden></div>
        </div>
        <div id="nameContainer" class="name-container" hidden>
          <label for="nameInput" class="small-label">Name</label>
          <input id="nameInput" type="text" class="text-input" list="nameList" placeholder="Name" autocomplete="off" disabled />
          <datalist id="nameList"></datalist>
          <div id="nameSuggestions" class="suggestion-row" hidden></div>
        </div>
        <div id="noteContainer" class="note-container" hidden>
          <textarea id="noteInput" placeholder="Note (optional)"></textarea>
        </div>
        <button id="toggleNote" class="btn ghost full">Add note</button>
        <div id="editDateContainer" class="date-edit" hidden>
          <label for="editDateInput" class="small-label">Transaction date & time</label>
          <input id="editDateInput" type="datetime-local" class="text-input" />
          <div class="preview small">Adjust this when editing to backdate entries.</div>
        </div>
        <div id="recurringContainer" class="recurring-container" hidden>
          <label class="recurring-toggle-label">
            <input id="recurringToggle" type="checkbox" />
            <span>Repeat this transaction</span>
          </label>
          <div id="recurringFrequency" class="recurring-frequency" hidden>
            <label for="frequencySelect" class="small-label">Frequency</label>
            <select id="frequencySelect" class="text-input">
              <option value="weekly">Weekly</option>
              <option value="monthly" selected>Monthly</option>
              <option value="yearly">Yearly</option>
            </select>
          </div>
        </div>
        <button id="confirmBtn" class="btn primary full" disabled>Add</button>
      </div>
    </div>
  </div>
  <script src="seasonal.js" defer></script>
  <script src="app.js" defer></script>
</body>
</html>
